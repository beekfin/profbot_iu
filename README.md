# Profbot IU

Телеграм-бот для профсоюзной организации студентов (Профком). Бот автоматизирует подачу заявлений, проверку статусов, оплату профвзносов и информирование студентов.

## Функционал

### Для студентов:
- **Профиль**: Регистрация и хранение данных (ФИО, группа, номер студенческого).
- **Новости и Мероприятия**: Просмотр новостей и автоматическая запись на мероприятия.
- **Заявления**:
  - Подача заявлений на материальную помощь.
  - Загрузка сканов/фото документов.
  - Проверка статуса заявлений (интеграция с Google Sheets).
- **Профвзносы**: Загрузка чеков об оплате и проверка статуса.
- **Расписание и Карта**: Быстрый доступ к полезной информации.
- **Обратная связь**: Отправка обращений администраторам.

### Для администраторов:
- **Проверка взносов**: Просмотр чеков и подтверждение/отклонение оплаты.
- **Обработка заявлений**: Просмотр и модерация поданных документов.
- **Отчеты**: Выгрузка CSV-отчетов по обращениям и записям на мероприятия.
- **Рассылка**: Автоматическое создание мероприятий из постов в канале.

## Установка и запуск

### Предварительные требования
- Docker и Docker Compose
- Python 3.12+ (для локального запуска)
- uv (менеджер пакетов)

### 1. Настройка окружения
Создайте файл `.env` в корне проекта и заполните его по образцу:

```env
API_TOKEN=ваш_токен_бота
SUPER_ADMIN_ID=ваш_telegram_id

# Настройки базы данных
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=profbot
DB_PORT=5432
DB_HOST=db  # или localhost для локального запуска

# Опционально
SCHEDULE_ID=file_id_расписания
```

### 2. Google Credentials
Для работы с Google Sheets (проверка статусов) необходимо поместить файл ключей сервисного аккаунта в `source/creds.json`.

### 3. Запуск через Docker (Рекомендуется)
Сборка и запуск контейнеров:
```bash
make up
```
Остановка:
```bash
make down
```

При первом запуске база данных будет автоматически инициализирована схемой из `schema.sql`.

### 4. Локальный запуск
Установите зависимости:
```bash
uv sync
```

Запустите бота:
```bash
python run.py
```

## Настройка новостного канала
Бот умеет автоматически создавать мероприятия из постов в канале.
1. Добавьте бота в канал как администратора.
2. Публикуйте посты с хэштегами:
   - `#мероприятия` — создаст запись в разделе "Мероприятия".
   - `#выплаты`, `#льготы`, `#конкурсы` — для рассылки подписчикам.

## Структура проекта
- `app/` — Исходный код бота.
  - `admin/` — Хендлеры админ-панели.
  - `student/` — Хендлеры для студентов.
  - `news/` — Работа с новостями и каналами.
- `schema.sql` — Схема базы данных PostgreSQL.
- `docker-compose.yaml` — Конфигурация Docker.

